document.addEventListener("DOMContentLoaded",()=>{const i={proxyUrl:"https://sh.dafeyan784.workers.dev/?target=",searchDebounceTime:300,maxRetries:3,retryDelay:1e3,errorMessageDisplayTime:5e3,fetchTimeout:1e4},o={resultsGrid:document.getElementById("results-grid"),searchInput:document.getElementById("search-input"),searchButton:document.getElementById("search-button"),loadingSpinner:document.getElementById("loading-spinner"),errorMessage:document.getElementById("error-message")},l={searchInProgress:!1},c=(e,r={},...t)=>{const s=document.createElement(e);return Object.entries(r).forEach(([e,r])=>s.setAttribute(e,r)),t.forEach(e=>"string"==typeof e?s.textContent=e:s.appendChild(e)),s},d=async(e,r={},t=i.fetchTimeout)=>{const s=new AbortController;t=setTimeout(()=>s.abort(),t);try{var a=await fetch(e,{...r,signal:s.signal});if(a.ok)return await a.text();throw new Error("HTTP error! Status: "+a.status)}catch(e){throw new Error("Fetch failed: "+e.message)}finally{clearTimeout(t)}},u=()=>o.loadingSpinner?.classList.add("active"),m=()=>o.loadingSpinner?.classList.remove("active"),g=e=>{o.errorMessage&&(o.errorMessage.textContent=e,o.errorMessage.classList.add("active"),setTimeout(()=>o.errorMessage.classList.remove("active"),i.errorMessageDisplayTime))},h=async(r,t=0)=>{if(r.trim()){if(!l.searchInProgress){l.searchInProgress=!0;var e="https://jnovels.com/?s="+encodeURIComponent(r),e=""+i.proxyUrl+encodeURIComponent(e);o.resultsGrid.innerHTML="",u();try{var s=await d(e),a=(new DOMParser).parseFromString(s,"text/html").querySelectorAll('a[rel="bookmark"]');if(0===a.length)o.resultsGrid.innerHTML="<p>No results found.</p>";else{const n=document.createDocumentFragment();a.forEach(e=>{e=y(e);e&&n.appendChild(e)}),o.resultsGrid?.appendChild(n)}}catch(e){console.error("Error during fetching or parsing:",e),t<i.maxRetries?(console.log(`Retrying fetch (${t+1}/${i.maxRetries})...`),setTimeout(()=>h(r,t+1),i.retryDelay)):g("There was an error fetching the results. Please try again later.")}finally{m(),l.searchInProgress=!1}}}else g("Please enter a valid search query.")},y=(e,r=0)=>{const t=e.querySelector("img");var s=e.getAttribute("title"),a=e.getAttribute("href");if(t&&s&&a){var n=c("div",{class:"grid-item"}),a=c("a",{href:a,target:"_blank",class:"grid-item-link"});const o=c("img",{src:t.src,alt:s});o.onload=()=>o.style.display="block",o.onerror=async()=>{r<i.maxRetries?setTimeout(()=>y(e,r+1),i.retryDelay):console.error(`Failed to load image after ${i.maxRetries} retries:`,t.src)};s=c("div",{class:"textElement"},s);return a.append(o,s),n.appendChild(a),n}return null},r=e=>{e.preventDefault();e=o.searchInput?.value.trim();e&&h(e)};(async()=>{e="query";var e=new URLSearchParams(window.location.search).get(e);e&&(o.searchInput.value=e,await h(e)),o.searchInput?.addEventListener("keydown",e=>{"Enter"===e.key&&r(e)}),o.searchButton?.addEventListener("click",r)})()});